<!doctype html>
<html lang="zh-CN">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, viewport-fit=cover"/>
<meta name="apple-mobile-web-app-capable" content="yes"/>
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"/>
<title>é˜¶æ®µä¸‰ Â· ç¤¾ä¼šè®¤çŸ¥ä¸è°ƒèŠ‚</title>
<style>
  :root{--bg:#0b1020;--panel:#0f1530;--line:#2a3561;--text:#e9edff;--muted:#aab4ff;--ok:#27c17d;--bad:#ff5d6a;--brand:#5b8cff;--r:18px}
  *{box-sizing:border-box}
  html,body{height:100%}
  body{margin:0;background:linear-gradient(180deg,#0b1020,#0b1126);color:var(--text);font-family:-apple-system,system-ui,"PingFang SC","Noto Sans SC",Arial}
  .app{min-height:100%;display:grid;grid-template-rows:auto 1fr auto;max-width:520px;margin:0 auto}
  header{position:sticky;top:0;background:rgba(15,21,48,.9);backdrop-filter:blur(8px);border-bottom:1px solid var(--line);z-index:20}
  .bar{display:flex;align-items:center;gap:10px;padding:10px 14px}
  .bar h1{font-size:18px;margin:0;font-weight:800}
  .bar .act{margin-left:auto;display:flex;gap:8px}
  .btn{display:inline-flex;align-items:center;justify-content:center;border:1px solid var(--line);background:#151d42;color:var(--text);border-radius:14px;padding:10px 14px;font-weight:700;min-height:44px;min-width:44px;touch-action:manipulation;-webkit-tap-highlight-color:transparent}
  .btn.primary{background:linear-gradient(90deg,var(--brand),#73a4ff);border-color:transparent;color:#fff}
  .btn.ghost{background:transparent}
  .btn:active{transform:scale(.98)}
  main{padding:12px}
  .sec{background:linear-gradient(160deg,var(--panel),#0d1330);border:1px solid var(--line);border-radius:var(--r);padding:12px;margin-bottom:12px}
  .sec h2{font-size:16px;margin:0 0 8px 0}
  .grid{display:grid;grid-template-columns:1fr;gap:8px}
  .tile{display:flex;align-items:center;gap:10px;background:linear-gradient(160deg,#121a3a,#0e1533);border:1px solid var(--line);border-radius:14px;padding:12px}
  .tile .ico{font-size:24px}
  .tile .meta{margin-left:auto;color:var(--muted);font-size:12px}
  .hero{display:flex;align-items:center;gap:10px;margin-bottom:8px}
  .hero .ico{font-size:22px}
  .card{background:linear-gradient(160deg,#11183a,#0d1330);border:1px solid var(--line);border-radius:16px;padding:12px}
  .choices{display:grid;grid-template-columns:1fr;gap:10px}
  .choice{border:2px solid var(--line);border-radius:14px;background:#151d42;color:var(--text);min-height:64px;font-size:18px;font-weight:700}
  .choice.good{border-color:var(--ok);background:linear-gradient(180deg,#10271f,#0e1f19)}
  .choice.bad{border-color:var(--bad);background:linear-gradient(180deg,#2a1620,#1c0f14)}
  .row{display:flex;gap:8px;align-items:center;justify-content:space-between;flex-wrap:wrap}
  .chip{padding:6px 10px;border-radius:999px;border:1px solid var(--line);background:#1b234a;color:var(--muted);font-size:12px}
  .coach{border:2px dashed var(--line);border-radius:14px;padding:10px;color:var(--muted)}
  footer{padding:8px 14px;color:var(--muted);font-size:12px;text-align:center}
</style>
</head>
<body>
<div class="app" id="app">
  <header>
    <div class="bar">
      <h1>ğŸ‘¥ é˜¶æ®µä¸‰ Â· ç¤¾ä¼šè®¤çŸ¥ä¸è°ƒèŠ‚</h1>
      <div class="act">
        <button class="btn" id="btnHome">ğŸ </button>
        <button class="btn" id="btnReport">ğŸ“ˆ</button>
        <button class="btn" id="btnExport">ğŸ§¾</button>
      </div>
    </div>
  </header>
  <main id="main" tabindex="-1" aria-live="polite"></main>
  <footer>Â© <span id="y"></span> æƒ…ç»ªè®­ç»ƒ Â· é˜¶æ®µä¸‰ Â· æœ¬åœ°è¿è¡Œ / iPad è§¦æ§ä¼˜åŒ–</footer>
</div>
<script>
(function(){
  const $=(s,el=document)=>el.querySelector(s);
  const $$=(s,el=document)=>Array.from(el.querySelectorAll(s));
  const DB_KEY='emo.stage3.v1';
  const state={score:{}, prefs:{speech:true}};
  const speak=(t)=>{ if(!state.prefs.speech) return; try{const u=new SpeechSynthesisUtterance(t);u.lang='zh-CN';speechSynthesis.cancel();speechSynthesis.speak(u);}catch(e){} };
  const save=()=>localStorage.setItem(DB_KEY,JSON.stringify(state));
  const load=()=>{try{const raw=localStorage.getItem(DB_KEY); if(raw) Object.assign(state, JSON.parse(raw));}catch(e){} };
  const bump=(gid,ok)=>{ const s=state.score[gid]||(state.score[gid]={ok:0,ng:0,best:0,last:''}); if(ok) s.ok++; else s.ng++; s.best=Math.max(s.best,s.ok); s.last=new Date().toLocaleString(); save(); };
  const csv=()=>{ const rows=[["game","ok","ng","best","last"]]; Object.entries(state.score).forEach(([g,s])=>rows.push([g,s.ok||0,s.ng||0,s.best||0,s.last||''])); return rows.map(r=>r.join('\n')).join('\n'); };
  const download=(name,content)=>{ const a=document.createElement('a'); a.href=URL.createObjectURL(new Blob([content],{type:'text/plain;charset=utf-8;'})); a.download=name; a.click(); URL.revokeObjectURL(a.href); };

  function home(){
    const items=[
      {id:'g7',hash:'#g7',ico:'ğŸ§­',name:'(7) ç¤¾ä¼šæƒ…å¢ƒå†³ç­–'},
      {id:'g8',hash:'#g8',ico:'ğŸ’¨',name:'(8) æƒ…ç»ªè°ƒèŠ‚ç­–ç•¥'},
      {id:'g9',hash:'#g9',ico:'ğŸ¤',name:'(9) å…±æƒ…ç†è§£'}
    ];
    $('#main').innerHTML=`<section class='sec'><h2>é€‰æ‹©ä¸€ä¸ªå°æ¸¸æˆå¼€å§‹</h2><div class='grid'>${items.map(x=>`<button class='tile' onclick=\"location.hash='${x.hash}'\"><div class='ico'>${x.ico}</div><div>${x.name}</div><div class='meta'>æœ€ä½³ ${(state.score[x.id]?.best)||0}</div></button>`).join('')}</div><div class='row' style='margin-top:8px'><span class='chip'>è¯­éŸ³æ’­æŠ¥å·²${state.prefs.speech?'å¼€å¯':'å…³é—­'}</span><button class='btn' id='toggleSpeech'>ğŸ”Š åˆ‡æ¢è¯­éŸ³</button></div></section>`;
    $('#toggleSpeech').onclick=()=>{state.prefs.speech=!state.prefs.speech; save(); home();};
    speak('è¯·é€‰æ‹©ä¸€ä¸ªè®­ç»ƒå¼€å§‹ã€‚');
  }

  function report(){
    const list=Object.entries(state.score);
    $('#main').innerHTML=`<section class='sec'><div class='hero'><div class='ico'>ğŸ“ˆ</div><h2>å­¦ä¹ æŠ¥å‘Š</h2></div><div class='card'><table style='width:100%;border-collapse:collapse;font-size:14px'><thead><tr><th style='text-align:left;padding:6px;border-bottom:1px solid var(--line)'>æ¸¸æˆ</th><th style='text-align:right;padding:6px;border-bottom:1px solid var(--line)'>âœ…</th><th style='text-align:right;padding:6px;border-bottom:1px solid var(--line)'>âŒ</th><th style='text-align:right;padding:6px;border-bottom:1px solid var(--line)'>ğŸ†</th><th style='text-align:right;padding:6px;border-bottom:1px solid var(--line)'>æœ€è¿‘</th></tr></thead><tbody>${list.map(([g,s])=>`<tr><td style='padding:6px;border-bottom:1px dashed var(--line)'>${g}</td><td style='padding:6px;text-align:right;border-bottom:1px dashed var(--line)'>${s.ok||0}</td><td style='padding:6px;text-align:right;border-bottom:1px dashed var(--line)'>${s.ng||0}</td><td style='padding:6px;text-align:right;border-bottom:1px dashed var(--line)'>${s.best||0}</td><td style='padding:6px;text-align:right;border-bottom:1px dashed var(--line)'>${s.last||'â€”'}</td></tr>`).join('')}</tbody></table></div><div class='row' style='margin-top:8px'><span class='chip'>æœ¬åœ°ä¿å­˜ Â· å¯å¯¼å‡º CSV</span><button class='btn primary' id='back'>è¿”å›ä¸»é¡µ</button></div></section>`;
    $('#back').onclick=()=>{location.hash='#home'}
  }

  // ======== g7 ç¤¾ä¼šæƒ…å¢ƒå†³ç­– ========
  function g7(){
    const bank=[
      {s:'æ’é˜Ÿæ—¶æœ‰äººæ’é˜Ÿ', opts:[
        {t:'å¤§å£°éª‚ä»–', ok:false, why:'ä¼šå¼•å‘å†²çªï¼Œä¸å®‰å…¨ã€‚'},
        {t:'é»˜é»˜ç”Ÿæ°”', ok:false, why:'é—®é¢˜æ²¡æœ‰è§£å†³ã€‚'},
        {t:'å‘Šè¯‰è€å¸ˆ/å®¶é•¿', ok:true,  why:'å¯»æ±‚å¤§äººå¸®åŠ©æ˜¯å®‰å…¨ä¸”åˆé€‚çš„æ–¹å¼ã€‚'},
        {t:'ä¹Ÿå»æ’åˆ«äººçš„é˜Ÿ', ok:false, why:'ä»¥ç‰™è¿˜ç‰™ä¼šè®©é—®é¢˜æ›´ç³Ÿã€‚'}]},
      {s:'åŒå­¦å€Ÿäº†ä½ çš„ç¬”æ²¡è¿˜', opts:[
        {t:'ç›´æ¥æŠ¢å›æ¥', ok:false, why:'ä¸ç¤¼è²Œä¸”å¯èƒ½ä¼¤äººã€‚'},
        {t:'ç¤¼è²Œæé†’å¯¹æ–¹', ok:true,  why:'ç”¨åˆé€‚è¯­è¨€è¡¨è¾¾è¯‰æ±‚æœ€æ°å½“ã€‚'},
        {t:'æŠŠå¯¹æ–¹ä¸œè¥¿è—èµ·æ¥', ok:false, why:'æŠ¥å¤è¡Œä¸ºä¸åˆé€‚ã€‚'},
        {t:'ä¸€ç›´å¿ç€ä¸è¯´', ok:false, why:'æƒ…ç»ªä¼šç§¯ç´¯ï¼Œé—®é¢˜ä»åœ¨ã€‚'}]},
      {s:'æœ‰äººåœ¨æ•™å®¤é‡Œå¤§å£°å–§å“—', opts:[
        {t:'åŠ å…¥ä¸€èµ·åµé—¹', ok:false, why:'ä¼šå½±å“ä»–äººå’Œè¯¾å ‚ç§©åºã€‚'},
        {t:'æ‚ä½è€³æœµå¹¶ç¦»å¼€åˆ°å®‰é™è§’è½', ok:true,  why:'å…ˆè‡ªæˆ‘è°ƒèŠ‚ï¼Œä¿æŠ¤è‡ªå·±ã€‚'},
        {t:'æ¨å¼€å¯¹æ–¹', ok:false, why:'æœ‰å®‰å…¨é£é™©ã€‚'},
        {t:'ç”Ÿé—·æ°”ä¸è¯´è¯', ok:false, why:'æ— æ³•æ”¹å˜ç°çŠ¶ã€‚'}]}
    ];
    const s=state.score.g7||{}; const q=bank[Math.floor(Math.random()*bank.length)];
    $('#main').innerHTML=`<section class='sec'><div class='hero'><div class='ico'>ğŸ‘¥</div><h2>(7) ç¤¾ä¼šæƒ…å¢ƒå†³ç­–</h2></div><div class='card'><p class='chip'>æƒ…å¢ƒï¼š${q.s}</p><div class='choices'>${q.opts.map((o,i)=>`<button class='choice' data-i='${i}'>${o.t}</button>`).join('')}</div><div class='coach' id='coach'>è¯·é€‰æ‹©æœ€åˆé€‚çš„åšæ³•ã€‚</div><div class='row' style='margin-top:8px'><span class='chip'>âœ… ${(s.ok||0)}ã€€âŒ ${(s.ng||0)}ã€€ğŸ† ${(s.best||0)}</span><button class='btn primary' id='next'>ä¸‹ä¸€é¢˜</button></div></div></section>`;
    const coach=$('#coach');
    $$('.choice').forEach(b=> b.onclick=()=>{ const o=q.opts[+b.dataset.i]; const ok=o.ok; b.classList.add(ok?'good':'bad'); bump('g7',ok); coach.textContent=(ok?'âœ… åšå¾—å¥½ï¼ ':'âŒ å†æƒ³æƒ³ã€‚ ')+o.why; speak(ok?'ä½ çœŸæ£’ï¼':'å†æƒ³æƒ³'); });
    $('#next').onclick=()=>g7();
  }

  // ======== g8 æƒ…ç»ªè°ƒèŠ‚ç­–ç•¥ ========
  function g8(){
    $('#main').innerHTML=`<section class='sec'><div class='hero'><div class='ico'>ğŸ’¨</div><h2>(8) æƒ…ç»ªè°ƒèŠ‚ç­–ç•¥</h2></div><div class='card'><p class='chip'>æˆ‘ç°åœ¨å¾ˆç”Ÿæ°”/ç´§å¼ ï¼Œæˆ‘å¯ä»¥â€¦â€¦</p><div class='choices' id='strats'><button class='choice' data-act='breath'>ğŸ’¨ æ·±å‘¼å¸5æ¬¡</button><button class='choice' data-act='count'>ğŸ”¢ ä»1æ•°åˆ°10</button><button class='choice' data-act='adult'>ğŸ‘¥ æ‰¾å¤§äººå¸®å¿™</button><button class='choice' data-act='draw'>ğŸ¨ ç”»ç”»è¡¨è¾¾</button></div><div class='coach' id='coach'>é€‰æ‹©ä¸€ä¸ªç­–ç•¥ï¼Œç³»ç»Ÿä¼šç»™åˆ†æ­¥æŒ‡å¯¼ã€‚</div><div class='row' style='margin-top:8px'><span class='chip'>âœ… ${(state.score.g8?.ok||0)}ã€€âŒ ${(state.score.g8?.ng||0)}ã€€ğŸ† ${(state.score.g8?.best||0)}</span><button class='btn primary' id='done'>æˆ‘å®Œæˆäº†</button></div></div></section>`;
    const coach=$('#coach'); let started=false;
    $('#strats').onclick=(e)=>{
      const b=e.target.closest('.choice'); if(!b) return; started=true; const act=b.dataset.act; bump('g8',true);
      if(act==='breath'){ coach.innerHTML='<b>ç»ƒä¹ ï¼šæ·±å‘¼å¸</b><ol><li>å¸æ°” 4 ç§’</li><li>åœ 2 ç§’</li><li>å‘¼æ°” 4 ç§’</li><li>é‡å¤ 5 æ¬¡</li></ol>'; speak('å¸å››ç§’ï¼Œåœä¸¤ç§’ï¼Œå‘¼å››ç§’ï¼Œä¸€å…±äº”æ¬¡ã€‚'); }
      if(act==='count'){ coach.innerHTML='<b>ç»ƒä¹ ï¼šæ•°æ•°</b><p>æ…¢æ…¢ä» 1 æ•°åˆ° 10ï¼Œé…åˆå‡åŒ€å‘¼å¸ã€‚</p>'; speak('æ…¢æ…¢ä»ä¸€æ•°åˆ°åã€‚'); }
      if(act==='adult'){ coach.innerHTML='<b>æ±‚åŠ©ï¼šæ‰¾å¤§äºº</b><p>è¯·æ‰¾åˆ°è€å¸ˆæˆ–å®¶é•¿ï¼Œæ¸…æ¥šè¯´å‡ºå‘ç”Ÿäº†ä»€ä¹ˆå’Œä½ çš„æ„Ÿå—ã€‚</p>'; speak('å»æ‰¾å¤§äººå¸®å¿™ï¼ŒæŠŠå‘ç”Ÿçš„äº‹æƒ…å’Œä½ çš„æ„Ÿå—è¯´æ¸…æ¥šã€‚'); }
      if(act==='draw'){ coach.innerHTML='<b>è¡¨è¾¾ï¼šç”»ç”»</b><p>æ‹¿çº¸ç¬”æŠŠä½ çš„æ„Ÿå—ç”»å‡ºæ¥ï¼Œå®Œæˆåç»™è€å¸ˆçœ‹ã€‚</p>'; speak('æ‹¿èµ·çº¸ç¬”ï¼ŒæŠŠä½ çš„æ„Ÿå—ç”»å‡ºæ¥ã€‚'); }
    };
    $('#done').onclick=()=>{ if(!started){ speak('å…ˆé€‰æ‹©ä¸€ä¸ªç­–ç•¥'); return;} speak('åšå¾—å¥½ï¼'); };
  }

  // ======== g9 å…±æƒ…ç†è§£ ========
  function g9(){
    const bank=[
      {story:'å°ç¾ç²¾å¿ƒå‡†å¤‡çš„ç”»è¢«åŒå­¦ä¸å°å¿ƒå¼„è„äº†ã€‚', ask:'å°ç¾ç°åœ¨æ„Ÿè§‰æ€ä¹ˆæ ·ï¼Ÿ', opts:[
        {t:'é«˜å…´', ok:false, why:'ç”»è¢«å¼„è„é€šå¸¸ä¸ä¼šé«˜å…´ã€‚'},
        {t:'ä¼¤å¿ƒ', ok:true,  why:'ä»˜å‡ºå¿ƒè¡€è¢«ç ´åï¼Œäººä¼šæ„Ÿåˆ°éš¾è¿‡ã€‚'},
        {t:'é¥¥é¥¿', ok:false, why:'ä¸æƒ…å¢ƒä¸ç›¸å…³ã€‚'}]},
      {story:'å°å¼ºåœ¨æ“åœºä¸Šè¢«äººæ¨äº†ä¸€æŠŠã€‚', ask:'ä»–æ›´å¯èƒ½çš„æ„Ÿå—ï¼Ÿ', opts:[
        {t:'ç”Ÿæ°”', ok:true,  why:'è¢«æ¨æŒ¤ä¼šç”Ÿæ°”ã€‚'},
        {t:'å¼€å¿ƒ', ok:false, why:'è¢«å†’çŠ¯ä¸€èˆ¬ä¸ä¼šå¼€å¿ƒã€‚'},
        {t:'å›°å€¦', ok:false, why:'ä¸æƒ…å¢ƒæ— å…³ã€‚'}]},
      {story:'å¦ˆå¦ˆæå‰æ¥æ¥æˆ‘ï¼Œå¹¶å¸¦äº†æˆ‘æœ€å–œæ¬¢çš„ç‚¹å¿ƒã€‚', ask:'æˆ‘æ›´å¯èƒ½çš„æ„Ÿå—ï¼Ÿ', opts:[
        {t:'å®³æ€•', ok:false, why:'æ²¡æœ‰å±é™©çº¿ç´¢ã€‚'},
        {t:'é«˜å…´', ok:true,  why:'è¢«å…³å¿ƒå’Œè¢«å¥–åŠ±é€šå¸¸ä¼šé«˜å…´ã€‚'},
        {t:'éš¾è¿‡', ok:false, why:'ä¸æƒ…å¢ƒä¸ç¬¦ã€‚'}]}
    ];
    const s=state.score.g9||{}; const q=bank[Math.floor(Math.random()*bank.length)];
    $('#main').innerHTML=`<section class='sec'><div class='hero'><div class='ico'>ğŸ¤</div><h2>(9) å…±æƒ…ç†è§£</h2></div><div class='card'><p class='chip'>æƒ³ä¸€æƒ³ï¼šå¦‚æœæ˜¯ä½ ä¼šæ€æ ·ï¼Ÿ</p><h3 style='margin:8px 0'>${q.story}</h3><p style='color:var(--muted)'>${q.ask}</p><div class='choices'>${q.opts.map((o,i)=>`<button class='choice' data-i='${i}'>${o.t}</button>`).join('')}</div><div class='coach' id='coach'>é€‰æ‹©ä½ è®¤ä¸ºæœ€åˆé€‚çš„ç­”æ¡ˆã€‚</div><div class='row' style='margin-top:8px'><span class='chip'>âœ… ${(s.ok||0)}ã€€âŒ ${(s.ng||0)}ã€€ğŸ† ${(s.best||0)}</span><button class='btn primary' id='next'>ä¸‹ä¸€é¢˜</button></div></div></section>`;
    const coach=$('#coach');
    $$('.choice').forEach(b=> b.onclick=()=>{ const o=q.opts[+b.dataset.i]; const ok=o.ok; b.classList.add(ok?'good':'bad'); bump('g9',ok); coach.textContent=(ok?'âœ… æ­£ç¡®ï¼ ':'âŒ å†æƒ³æƒ³ã€‚ ')+o.why; speak(ok?'ä½ çœŸæ£’ï¼':'å†æƒ³æƒ³'); });
    $('#next').onclick=()=>g9();
  }

  const routes={'#home':home,'':home,'#report':report,'#g7':g7,'#g8':g8,'#g9':g9};
  function router(){ (routes[location.hash]||home)(); window.scrollTo({top:0,behavior:'instant'}); }
  function bind(){
    $('#btnHome').onclick=()=>location.hash='#home';
    $('#btnReport').onclick=()=>location.hash='#report';
    $('#btnExport').onclick=()=>download('stage3_report.csv', csv());
  }
  load(); bind(); router(); window.addEventListener('hashchange',router); $('#y').textContent=new Date().getFullYear();
})();
</script>
</body>
</html>
